<script src="vendor/chart.js/Chart.min.js"></script>
<script src="js/dashboard/chart-pie-demo.js"></script>

<script>
    let socket = new WebSocket("<%= ws  %>/api/dashboard/");

    socket.onopen = function (e) {
        socket.send("message");
    };

    socket.onmessage = function (event) {
        if (event.data.slice(1, 3) === "pr") {
            document.getElementById("production").innerHTML = event.data.slice(3, event.data.length - 1) + "kWh";
        } else if (event.data.slice(1, 3) === "co") {
            document.getElementById("consumption").innerHTML = event.data.slice(3, event.data.length - 1) + "kWh";
        } else if (event.data.slice(1, 3) === "ne") {
            document.getElementById("net").innerHTML = event.data.slice(3, event.data.length - 1) + "kWh";
        } else if (event.data.slice(1, 3) === "bu") {
            document.getElementById("buffer_percentage").innerHTML = event.data.slice(3, event.data.length - 1) + "%";
            document.getElementById("progress_bar").style.width = event.data.slice(3, event.data.length - 1) + "%";
        } else if (event.data.slice(1, 3) === "ep") {
            document.getElementById("price").innerHTML = event.data.slice(3, event.data.length - 1) + "kr";
        } else if (event.data.slice(1, 3) === "ba") {
            document.getElementById("balance").innerHTML = event.data.slice(3, event.data.length - 1) + "kr";
        } else if (event.data.slice(0, 2) === "ch") {
            let winds = JSON.parse(event.data.slice(2, event.data.length))
            winds.forEach(obj => {
                winds_data.push(obj.wind)
            });
            windsChart.update()
        }
    };

    socket.onclose = function (event) {
        if (event.wasClean) {
            alert(`[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
        } else {
            // e.g. server process killed or network down
            // event.code is usually 1006 in this case
            alert('[close] Connection died');
        }
    };

    socket.onerror = function (error) {
        alert(`[error] ${error.message}`);
    };

</script>

<%- include('winds_chart_script'); -%>